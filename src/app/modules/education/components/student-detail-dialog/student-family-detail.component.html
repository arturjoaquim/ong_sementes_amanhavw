<div class="flex flex-col space-y-4">
  <!-- Dados da Família -->
  <app-card contentClass="p-6">
    <app-section-header (edit)="editData('family')">Dados da Família</app-section-header>
    <div class="grid grid-cols-3 gap-6">
      <app-detail-field
        label="Tipo de Domicílio"
        [value]="dwellingType"
        [icon]="icons['home']"
        iconBgColor="bg-blue-50"
        iconColor="text-blue-600"
      />
      <app-detail-field
        label="CRAS"
        [value]="family?.crasName || 'Não informado'"
        [icon]="icons['home']"
        iconBgColor="bg-blue-50"
        iconColor="text-blue-600"
      />
      <app-detail-field
        label="Vencimento das Informações"
        [value]="(family?.informationExpirationDate | date: 'dd/MM/yyyy') || 'Não informado'"
        [icon]="icons['calendar']"
        iconBgColor="bg-orange-50"
        iconColor="text-orange-600"
      />
    </div>
    @if (family?.familyEvaluation) {
      <div class="mt-6">
        <app-detail-field
          label="Avaliação Familiar"
          [value]="family!.familyEvaluation"
          [icon]="icons['clipboard']"
          iconBgColor="bg-indigo-50"
          iconColor="text-indigo-600"
        />
      </div>
    }
  </app-card>

  <!-- Comportamento Domiciliar -->
  <app-card contentClass="p-6">
    <app-section-header (edit)="editData('dwelling')">Vivência Domiciliar</app-section-header>
    <div class="grid grid-cols-3 gap-6">
      <app-detail-field
        label="Estado Civil dos Pais"
        [value]="parentsMaritalStatus"
        [icon]="icons['users']"
        iconBgColor="bg-yellow-50"
        iconColor="text-yellow-600"
      />

      @if (dwelling?.parentsMaritalStatusId === 2 || dwelling?.parentsMaritalStatusId === 3) {
        <app-detail-field
          label="Contato com Cônjuge Separado"
          [value]="dwelling!.hasSeparatedParentContact ? 'Sim' : 'Não'"
          [icon]="icons['phone']"
          iconBgColor="bg-blue-50"
          iconColor="text-blue-600"
        />
      }

      <app-detail-field
        label="Permanece Sozinho em Casa"
        [value]="dwelling?.staysHomeAlone ? 'Sim' : 'Não'"
        [icon]="icons['home']"
        iconBgColor="bg-blue-50"
        iconColor="text-blue-600"
      />
      @if (dwelling?.description) {
        <app-detail-field
          label="Observações sobre a Vivência"
          [value]="dwelling!.description"
          [icon]="icons['clipboard']"
          iconBgColor="bg-indigo-50"
          iconColor="text-indigo-600"
          class="col-span-3"
        />
      }
    </div>
  </app-card>

  <!-- Responsável Legal -->
  <app-card contentClass="p-6">
    <app-section-header [showEditButton]="false"> Responsável Legal </app-section-header>
    <div class="space-y-2">
      @if (guardians.length > 0) {
        @for (guardian of guardians; track guardian.id; let i = $index) {
          <app-accordion-item
            [isOpen]="this.openGuardianIndex === i"
            (toggled)="toggleGuardian(i)"
            (edit)="editGuardian(guardian)"
            (remove)="removeGuardian(guardian.id)"
            [showEditButton]="true"
            [showRemoveButton]="true"
          >
            <app-accordion-header>
              {{ guardian.peopleData.personName }}
            </app-accordion-header>
            <app-accordion-body>
              <div class="grid grid-cols-3 gap-x-6 gap-y-4">
                <app-detail-field
                  label="Grau de Parentesco"
                  [value]="getKinshipName(guardian.kinshipDegreeId)"
                  [icon]="icons['users']"
                  iconBgColor="bg-blue-50"
                  iconColor="text-blue-600"
                />
                <app-detail-field
                  label="Telefone"
                  [value]="getGuardianPhone(guardian)"
                  [icon]="icons['phone']"
                  iconBgColor="bg-blue-50"
                  iconColor="text-blue-600"
                />
                @if (getGuardianCpf(guardian)) {
                  <app-detail-field
                    label="CPF"
                    [value]="getGuardianCpf(guardian)"
                    [icon]="icons['fileText']"
                    iconBgColor="bg-blue-50"
                    iconColor="text-blue-600"
                  />
                }
                <app-detail-field
                  label="Data de Nascimento"
                  [value]="guardian.peopleData.birthDate | date: 'dd/MM/yyyy'"
                  [icon]="icons['calendar']"
                  iconBgColor="bg-blue-50"
                  iconColor="text-blue-600"
                />
              </div>
            </app-accordion-body>
          </app-accordion-item>
        }
      } @else {
        <p class="text-sm text-gray-600">Nenhum responsável legal registrado</p>
      }
    </div>
    <div class="flex justify-end">
      <button appButton (click)="addGuardian()" class="cursor-pointer" variant="outline">
        Adicionar Responsável
      </button>
    </div>
  </app-card>

  <!-- Membros da Familia -->
  <app-card contentClass="p-6">
    <app-section-header [showEditButton]="false"> Membros da Família </app-section-header>
    @if (family?.familyMembers && family!.familyMembers.length > 0) {
      <app-data-table [items]="family!.familyMembers" [columns]="familyMemberColumns">
        <ng-template #commandsTemplate let-member>
          <app-data-table-commands
            [item]="member"
            (edit)="onEditFamilyMember($event)"
            (delete)="onDeleteFamilyMember($event)"
          >
          </app-data-table-commands>
        </ng-template>
      </app-data-table>
    } @else {
      <p class="text-sm text-gray-600">Nenhum membro familiar registrado</p>
    }
    <div class="flex justify-end">
      <button appButton class="cursor-pointer" (click)="addFamilyMember()" variant="outline">
        Adicionar Familiar
      </button>
    </div>
  </app-card>

  <!-- Histórico de Visitas Domiciliares -->
  <app-card contentClass="p-6">
    <app-section-header (edit)="editData('visits')" [showEditButton]="false">
      Histórico de Visitas Domiciliares
    </app-section-header>
    <div class="space-y-2">
      @if (visits.length > 0) {
        @for (visit of visits; track visit.id; let i = $index) {
          <app-accordion-item [isOpen]="openVisitIndex === i" (toggled)="toggleVisit(i)">
            <app-accordion-header>
              <span class="font-medium text-gray-800">
                {{ visit.date | date: 'dd/MM/yyyy' }} - {{ visit.summary }}
              </span>
            </app-accordion-header>
            <app-accordion-body>
              <div>
                <p class="text-sm text-gray-700">
                  {{ visit.description }}
                </p>
              </div>
            </app-accordion-body>
          </app-accordion-item>
        }
      } @else {
        <p class="text-sm text-gray-600">Nenhuma visita domiciliar registrada</p>
      }
    </div>
  </app-card>
</div>
