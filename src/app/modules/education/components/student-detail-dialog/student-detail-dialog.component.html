<app-dialog contentClass="sm:max-w-3xl max-h-[90vh] overflow-y-auto">
  <app-dialog-header>
    <app-dialog-title>Detalhes do Estudante</app-dialog-title>
    <app-dialog-description>
      Visualize as informações completas do estudante
    </app-dialog-description>
  </app-dialog-header>

  <!-- Student Header -->
  <div class="flex items-start gap-6 pb-6 border-b border-gray-200 mt-4">
    <app-avatar contentClass="h-20 w-20">
      <img class="app-avatar-image" [src]="student.avatar" [alt]="name" />
      <app-avatar-fallback>{{ getInitials(name) }}</app-avatar-fallback>
    </app-avatar>

    <div class="flex-1">
      <div class="flex items-start justify-between">
        <div>
          <h3 class="text-xl font-semibold text-gray-900">{{ name }}</h3>
          <p class="text-gray-600 mt-1">ID: {{ student.id }}</p>
        </div>
        <app-badge [contentClass]="getStatusColor(student.status)">
          {{
            student.status === 'active'
              ? 'Ativo'
              : student.status === 'inactive'
                ? 'Inativo'
                : 'Graduado'
          }}
        </app-badge>
      </div>

      <div class="grid grid-cols-3 gap-4 mt-4">
        <div>
          <p class="text-xs text-gray-500">Série/Ano</p>
          <p class="text-sm text-gray-900 mt-1">Não definido</p>
        </div>
        <div>
          <p class="text-xs text-gray-500">Idade</p>
          <p class="text-sm text-gray-900 mt-1">{{ age }} anos</p>
        </div>
        <div>
          <p class="text-xs text-gray-500">Taxa de Frequência</p>
          <p class="text-sm mt-1" [ngClass]="getAttendanceColor(student.attendance)">
            {{ student.attendance }}%
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="flex gap-2 flex-col space-y-4 mt-6">
    <app-card contentClass="p-6">
      <h4 class="text-base font-semibold text-gray-900 mb-4">Dados da Matrícula</h4>
      <div class="grid grid-cols-3 gap-6">
        <!-- Período -->
        <div class="flex items-start gap-3">
          <div class="bg-blue-50 p-2 rounded-lg">
            <lucide-icon
              [img]="icons.graduationCap"
              [size]="18"
              class="text-blue-600"
            ></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Período</p>
            <p class="text-sm text-gray-900 mt-1">{{ period }}</p>
          </div>
        </div>
        <!-- Origem da Inscrição -->
        <div class="flex items-start gap-3">
          <div class="bg-teal-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.mapPin" [size]="18" class="text-teal-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Origem da Inscrição</p>
            <p class="text-sm text-gray-900 mt-1">{{ enrollmentOrigin }}</p>
          </div>
        </div>
        <!-- Data da Inscrição -->
        <div class="flex items-start gap-3">
          <div class="bg-orange-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.calendar" [size]="18" class="text-orange-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Data da Inscrição</p>
            <p class="text-sm text-gray-900 mt-1">{{ enrollmentDate | date: 'dd/MM/yyyy' }}</p>
          </div>
        </div>
        <!-- Vem Acompanhado? -->
        <div class="flex items-start gap-3">
          <div class="bg-yellow-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.users" [size]="18" class="text-yellow-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Vem Acompanhado?</p>
            <p class="text-sm text-gray-900 mt-1">{{ accompaniedStatus ? 'Sim' : 'Não' }}</p>
          </div>
        </div>
        <!-- Nome do Acompanhante -->
        @if (accompaniedStatus) {
          <div class="flex items-start gap-3">
            <div class="bg-green-50 p-2 rounded-lg">
              <lucide-icon
                [img]="icons.userCircle"
                [size]="18"
                class="text-green-600"
              ></lucide-icon>
            </div>
            <div>
              <p class="text-xs text-gray-500">Nome do Acompanhante</p>
              <p class="text-sm text-gray-900 mt-1">
                {{ transportGuardianName || 'Não informado' }}
              </p>
            </div>
          </div>
        }
      </div>
    </app-card>
  </div>

  <!-- Dados pessoais -->
  <div class="flex gap-2 flex-col space-y-4 mt-6">
    <app-card contentClass="p-6">
      <h4 class="text-base font-semibold text-gray-900 mb-4">Dados Pessoais</h4>
      <div class="grid grid-cols-3 gap-6">
        <!-- Nome Completo -->
        <div class="flex items-start gap-3">
          <div class="bg-green-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.userCircle" [size]="18" class="text-green-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Nome Completo</p>
            <p class="text-sm text-gray-900 mt-1">{{ name }}</p>
          </div>
        </div>
        <!-- Data de Nascimento -->
        <div class="flex items-start gap-3">
          <div class="bg-orange-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.calendar" [size]="18" class="text-orange-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Data de Nascimento</p>
            <p class="text-sm text-gray-900 mt-1">{{ birthDate | date: 'dd/MM/yyyy' }}</p>
          </div>
        </div>
        <!-- Idade -->
        <div class="flex items-start gap-3">
          <div class="bg-blue-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.calendar" [size]="18" class="text-blue-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Idade</p>
            <p class="text-sm text-gray-900 mt-1">{{ age }} anos</p>
          </div>
        </div>
        <!-- Gênero -->
        <div class="flex items-start gap-3">
          <div class="bg-yellow-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.users" [size]="18" class="text-yellow-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Gênero</p>
            <p class="text-sm text-gray-900 mt-1">{{ gender }}</p>
          </div>
        </div>
        <!-- Raça/Cor -->
        <div class="flex items-start gap-3">
          <div class="bg-indigo-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.users" [size]="18" class="text-indigo-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Raça/Cor</p>
            <p class="text-sm text-gray-900 mt-1">{{ race }}</p>
          </div>
        </div>
        <!-- Naturalidade -->
        <div class="flex items-start gap-3">
          <div class="bg-teal-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.mapPin" [size]="18" class="text-teal-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Naturalidade</p>
            <p class="text-sm text-gray-900 mt-1">{{ naturalness }}</p>
          </div>
        </div>
        <!-- Nome da Mãe -->
        <div class="flex items-start gap-3">
          <div class="bg-gray-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.userCircle" [size]="18" class="text-gray-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Nome da Mãe</p>
            <p class="text-sm text-gray-900 mt-1">{{ motherName }}</p>
          </div>
        </div>
        <!-- Nome do Pai -->
        <div class="flex items-start gap-3">
          <div class="bg-gray-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.userCircle" [size]="18" class="text-gray-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">Nome do Pai</p>
            <p class="text-sm text-gray-900 mt-1">{{ fatherName }}</p>
          </div>
        </div>
      </div>
    </app-card>

    <!-- Civil Documents -->
    <app-card contentClass="p-6">
      <h4 class="text-base font-semibold text-gray-900 mb-4">Documentos Civis</h4>
      <div class="grid grid-cols-3 gap-6">
        <!-- CPF -->
        @if (cpf) {
          <div class="flex items-start gap-3">
            <div class="bg-blue-50 p-2 rounded-lg">
              <lucide-icon [img]="icons.fileText" [size]="18" class="text-blue-600"></lucide-icon>
            </div>
            <div>
              <p class="text-xs text-gray-500">CPF</p>
              <p class="text-sm text-gray-900 mt-1">{{ cpf }}</p>
            </div>
          </div>
        }
        <!-- NIS -->
        <div class="flex items-start gap-3">
          <div class="bg-pink-50 p-2 rounded-lg">
            <lucide-icon [img]="icons.fileText" [size]="18" class="text-pink-600"></lucide-icon>
          </div>
          <div>
            <p class="text-xs text-gray-500">NIS</p>
            <p class="text-sm text-gray-900 mt-1">{{ nisNumber }}</p>
          </div>
        </div>
        <!-- RG -->
        @if (rg) {
          <div class="flex items-start gap-3">
            <div class="bg-purple-50 p-2 rounded-lg">
              <lucide-icon [img]="icons.fileText" [size]="18" class="text-purple-600"></lucide-icon>
            </div>
            <div>
              <p class="text-xs text-gray-500">RG</p>
              <p class="text-sm text-gray-900 mt-1">{{ rg }}</p>
            </div>
          </div>
        }
        <!-- Certidão de Nascimento -->
        @if (birthCertificate) {
          <div class="flex items-start gap-3">
            <div class="bg-gray-50 p-2 rounded-lg">
              <lucide-icon [img]="icons.fileText" [size]="18" class="text-gray-600"></lucide-icon>
            </div>
            <div>
              <p class="text-xs text-gray-500">Certidão de Nascimento</p>
              <p class="text-sm text-gray-900 mt-1">{{ birthCertificate.number }}</p>
            </div>
          </div>
        }
      </div>
    </app-card>

    <!-- Guardian Information -->
    <app-card contentClass="p-6">
      <h4 class="text-base font-semibold text-gray-900 mb-4">Responsável Legal</h4>
      <div class="space-y-2">
        @for (guardian of guardians; track guardian.id; let i = $index) {
          <div class="border border-gray-200 rounded-lg">
            <button
              type="button"
              class="w-full flex items-center justify-between p-4 text-left"
              (click)="toggleGuardian(i)"
            >
              <span class="font-medium text-gray-800">{{ guardian.peopleData.name }}</span>
              <lucide-icon
                [img]="icons.chevronDown"
                [size]="20"
                class="text-gray-500 transition-transform"
                [class.rotate-180]="openGuardianIndex === i"
              ></lucide-icon>
            </button>

            @if (openGuardianIndex === i) {
              <div class="p-4 border-t border-gray-200 bg-gray-50 grid grid-cols-3 gap-x-6 gap-y-4">
                <div class="flex items-start gap-3">
                  <div class="bg-yellow-50 p-2 rounded-lg">
                    <lucide-icon
                      [img]="icons.users"
                      [size]="18"
                      class="text-yellow-600"
                    ></lucide-icon>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500">Grau de Parentesco</p>
                    <p class="text-sm text-gray-900 mt-1">{{ getGuardianKinship(guardian) }}</p>
                  </div>
                </div>

                <div class="flex items-start gap-3">
                  <div class="bg-blue-50 p-2 rounded-lg">
                    <lucide-icon
                      [img]="icons.phone"
                      [size]="18"
                      class="text-blue-600"
                    ></lucide-icon>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500">Telefone</p>
                    <p class="text-sm text-gray-900 mt-1">{{ getGuardianPhone(guardian) }}</p>
                  </div>
                </div>

                @if (getGuardianCpf(guardian)) {
                  <div class="flex items-start gap-3">
                    <div class="bg-blue-50 p-2 rounded-lg">
                      <lucide-icon
                        [img]="icons.fileText"
                        [size]="18"
                        class="text-blue-600"
                      ></lucide-icon>
                    </div>
                    <div>
                      <p class="text-xs text-gray-500">CPF</p>
                      <p class="text-sm text-gray-900 mt-1">{{ getGuardianCpf(guardian) }}</p>
                    </div>
                  </div>
                }

                <div class="flex items-start gap-3">
                  <div class="bg-orange-50 p-2 rounded-lg">
                    <lucide-icon
                      [img]="icons.calendar"
                      [size]="18"
                      class="text-orange-600"
                    ></lucide-icon>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500">Data de Nascimento</p>
                    <p class="text-sm text-gray-900 mt-1">
                      {{ guardian.peopleData.birthDate | date: 'dd/MM/yyyy' }}
                    </p>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </app-card>

    <!-- Family Information -->
    @if (family) {
      <app-card contentClass="p-6">
        <h4 class="text-base font-semibold text-gray-900 mb-4">Informações Familiares</h4>
        @if (family.familyMembers && family.familyMembers.length > 0) {
          <div class="space-y-3">
            @for (member of family.familyMembers; track member.id) {
              <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <div class="grid grid-cols-4 gap-4">
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Nome</p>
                    <p class="text-sm text-gray-900">{{ member.name }}</p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Relação</p>
                    <p class="text-sm text-gray-900">{{ member.relationship }}</p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Profisão</p>
                    <p class="text-sm text-gray-900">
                      {{ member.profession || 'Não especificado' }}
                    </p>
                  </div>
                  <div>
                    <p class="text-xs text-gray-500 mb-1">Renda</p>
                    <p class="text-sm text-gray-900">
                      {{ member.income ? 'R$ ' + member.income : 'Não especificado' }}
                    </p>
                  </div>
                </div>
              </div>
            }
          </div>
        } @else {
          <p class="text-sm text-gray-600">Nenhum membro familiar registrado</p>
        }
      </app-card>
    }

    <!-- Medical Information -->
    @if (student.healthData) {
      <app-card contentClass="p-6">
        <h4 class="text-base font-semibold text-gray-900 mb-4">Informações Médicas</h4>
        <div class="space-y-4">
          @if (student.healthData.medicalNotes.length > 0) {
            @for (note of student.healthData.medicalNotes; track note.studentMedicalNoteId) {
              <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                <div>
                  <p class="text-xs text-gray-500 mb-1">{{ note.summaryNote }}</p>
                  <p class="text-sm text-gray-900">
                    {{ note.description }}
                  </p>
                  @if (note.descriptionEmergencyProcedure) {
                    <p class="text-sm text-red-600 mt-1">
                      <strong>Procedimento de Emergência:</strong>
                      {{ note.descriptionEmergencyProcedure }}
                    </p>
                  }
                </div>
              </div>
            }
          } @else {
            <p class="text-sm text-gray-600">Nenhuma informação médica registrada.</p>
          }

          <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
            <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
              <div>
                <p class="text-xs text-gray-500 mb-1">Usa óculos?</p>
                <p class="text-sm text-gray-900">{{ student.healthData.flagUseGlasses }}</p>
              </div>
            </div>
          </div>
        </div>
      </app-card>
    }
  </div>
</app-dialog>
